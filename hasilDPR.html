<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Visualisasi Hasil Pemilu 2024</title>
        <link href="css/styles.css" rel="stylesheet" />
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
        <style>
            #map {
                width: 100%;
                height: 93vh;
            }
            .body {
                padding-top: 50px; /* Sesuaikan dengan tinggi navbar */
                padding-bottom: 0;
                padding-left: 0;
                padding-right: 0;
            }
            .info {
                padding: 6px 8px;
                font: 14px Arial, Helvetica, sans-serif;
                background: white;
                background: rgba(255,255,255,0.8);
                box-shadow: 0 0 15px rgba(0,0,0,0.2);
                border-radius: 5px;
            }
            .info h3 {
                margin: 0 0 5px;
                color: #777;
                font:  bold 18px Arial;
            }
            .legend {
                padding: 6px 8px;
                line-height: 18px;
                color: #555;
                background: white;
                background: rgba(255,255,255,0.8);
                box-shadow: 0 0 15px rgba(0,0,0,0.2);
                border-radius: 5px;
            }
            .legend i {
                width: 18px;
                height: 18px;
                float: left;
                margin-right: 8px;
                margin-bottom: 0%;
                opacity: 0.7;
            }
            .legend-wrapper {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap; /* Untuk memastikan elemen yang panjang akan membungkus ke baris berikutnya */
            }
            .legend-tittle {
                margin: 0;
                margin-bottom: 2px;
                color: #524f4f;
                font-weight: bold; /* Mengatur font tebal */
                font-size: 13px; /* Mengatur ukuran font */
                padding-bottom: 5px; /* Mengatur jarak bawah */
            }
            .chart-container {
                justify-content: center;
                align-items: center;
                width: 300px;
                height: 200px;
                margin: 10px auto;
            }
            #barchart {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body class="sb-nav-fixed">
        <nav class="sb-topnav navbar navbar-expand navbars-light bgs-light style height: 50px">
            <!-- Sidebar Toggle-->
            <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
            <!-- Navbar-->
            <ul class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
                <a class="navbars-brand ps-3" href="index.html">Visualisasi Hasil Pemilu 2024</a>
                <img class= "navbar-logo" src="assets\img\logoUGM.png" alt="Logo" style="height: 40px; width: auto;">
            </ul>
        </nav>
        
        <!-- side bar-->>
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                    <div class="sb-sidenav-menu">
                        <div class="nav">
                            <div class="sb-sidenav-menu-heading">Beranda</div>
                            <a class="nav-link" href="index.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-book-reader"></i></div>
                                Pemilihan Umum
                            </a>

                            <div class="sb-sidenav-menu-heading">Hasil Pemilu 2024</div>
                            <a class="nav-link" href="hasilPRESIDEN.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-map"></i></div>
                                Presiden
                            </a>
                            <a class="nav-link" href="hasilDPR.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-map-marked-alt"></i></div>
                                DPR RI
                            </a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
        
        <!-- Leaflet JavaScript -->
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid mt-4">
                </div class="card mb-4">
                    <div id="map"></div>
                    <script src="js/dpr_comp.js"></script>
                    <script>
                    var map = L.map('map', {
                    center: [-1.401111, 116.827850],
                    zoom: 5});
                    var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})
                    .addTo(map);

                    // pemberian warna berdasarkan hasil perolehan suara
                    function getColor(d) {
                        var colorMapping = {
                            'PKB - TINGGI': '#02754c', 
                            'PKB - SEDANG': '#7cb396',
                            'PKB - RENDAH': '#BDD9CA',
                            'GERINDRA - TINGGI': '#c48434',
                            'GERINDRA - SEDANG': '#e4b686',
                            'GERINDRA - RENDAH': '#F3DEC9',
                            'PDIP - TINGGI': '#d21d25',
                            'PDIP - SEDANG': '#f28e7d',
                            'PDIP - RENDAH': '#ffcabb',
                            'GOLKAR - TINGGI' : '#fbcc04',
                            'GOLKAR - SEDANG' : '#fce16f',
                            'GOLKAR - RENDAH' : '#fff4b4',
                            'NASDEM - TINGGI' : '#17158b',
                            'NASDEM - SEDANG' : '#7e61c4',
                            'NASDEM - RENDAH' : '#d1b4ff',
                            'PKS - TINGGI' : '#f85206',
                            'PKS - SEDANG' : '#fba256',
                            'PKS - RENDAH' : '#ffdeb2',
                            'PAN - TINGGI' : '#00b0df',
                            'PAN - SEDANG' : '#73caef',
                            'PAN - RENDAH' : '#afe1fa',
                            'DEMOKRAT - TINGGI' : '#1c448b',
                            'DEMOKRAT - SEDANG' : '#709cc6',
                            'DEMOKRAT - RENDAH' : '#B5CBE1'
                        };
                        return colorMapping[d] || 'black'; // else
                    }

                    // style peta
                    function style(feature) {
                        return {fillColor: getColor(feature.properties.TingkatKem),
                            weight: 2,
                            opacity: 1,
                            color: 'white',
                            dashArray: '3', // batas garis putus-putus
                            fillOpacity: 0.7
                        };
                    }

                    // menambah interaksi
                    function highlightFeature(e) {
                        var  layer = e.target;
                        layer.setStyle({
                            dashArray: '',
                            weight: 3,
                            color: '#666',
                            fillOpacity: 0.7
                        });
                        layer.bringToFront();
                        info.update(layer.feature.properties);
                    }
                    function resetHighlight(e) {
                        geojson.resetStyle(e.target);
                        info.update();
                    }   

                    var geojson;
        
                    function zoomToFeature(e) {
                        map.fitBounds(e.target.getBounds());
                    }
                    function onEachFeature(feature, layer) {
                        layer.on({
                            mouseover: highlightFeature,
                            mouseout: resetHighlight,
                            click: zoomToFeature
                        });
                    }

                    geojson = L.geoJson(dpr_comp, {
                        style: style,
                        onEachFeature: onEachFeature
                    }).addTo(map);
                    
                    // mengatur tampilan informasi berdasarkan mouseover
                    var info = L.control();
                    
                    info.onAdd = function (map) {
                        this._div = L.DomUtil.create('div', 'info');
                        this.update();
                        return this._div;
                    };
                    
                    info.update = function (props) {
                        this._div.innerHTML = 
                        '<h3>Hasil Pemilu DPR RI 2024</h3>' +  
                        (props ?
                        '<b>' + props.dapil + '</b><br />' + 
                        '<table>' +
                            '<tr>' +
                                '<td>DPT</td>' +
                                '<td>= ' + props.DPT + '</td>' +
                            '</tr>' +
                            '<tr>' +
                                '<td>PKB</td>' +
                                '<td>= ' + props.PKB + ' (' + props.P_PKB + ')</td>' +
                            '</tr>' +
                            '<tr>' +
                                '<td>GERINDRA</td>' +                     
                                '<td>= ' + props.GERINDRA + ' (' + props.P_GERINDRA + ')</td>' +
                            '</tr>' +           
                            '<tr>' +
                                '<td>PDIP</td>' +
                                '<td>= ' + props.PDIP + ' (' + props.P_PDIP + ')</td>' +
                            '</tr>' +
                            '<tr>' +
                                '<td>GOLKAR</td>' +
                                '<td>= ' + props.GOLKAR + ' (' + props.P_GOLKAR + ')</td>' +
                            '</tr>' +
                            '<tr>' +
                                '<td>NASDEM</td>' +
                                '<td>= ' + props.NASDEM + ' (' + props.P_NASDEM + ')</td>' +
                            '</tr>' +
                            '<tr>' +
                                '<td>PKS</td>' +
                                '<td>= ' + props.PKS + ' (' + props.P_PKS + ')</td>' +
                            '</tr>' +
                            '<tr>' +
                                '<td>PAN</td>' +
                                '<td>= ' + props.PAN + ' (' + props.P_PAN + ')</td>' +
                            '</tr>' +
                            '<tr>' +
                                '<td>DEMOKRAT</td>' +
                                '<td>= ' + props.DEMOKRAT + ' (' + props.P_DEMOKRAT + ')</td>' +
                            '</tr>' +
                            '<tr>' +
                                '<td>Tingkat Partisipasi</td>' +
                                '<td>= ' + props.TingkatPar + '</td>' +
                            '</tr>' +
                        '</table>'+
                        '<div class="chart-container"><canvas id="barChart"></canvas></div>'
                        : 'Pilih lokasi pemilihan'
                        );
                        
                        if (props) {
                            updatebarChart(props);
                        }
                    };
                    info.addTo(map);

                    // Fungsi untuk memperbarui bar chart
                    function updatebarChart(props) {
                        var ctx = document.getElementById('barChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['PKB', 'GERINDRA', 'PDIP', 'GOLKAR', 'NASDEM', 'PKS', 'PAN', 'DEMOKRAT'],
                                datasets: [{
                                    data: [props.AK_PKB, props.AK_GERINDR, props.AK_PDIP, props.AK_GOLKAR, props.AK_NASDEM, props.AK_PKS, props.AK_PAN, props.AK_DEMOKRA],
                                    backgroundColor: ['#02754c','#c48434', '#d21d25', '#fbcc04', '#17158b', '#f85206', '#00b0df', '#1c448b']
                                }]
                            },
                            options: {  
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true,
                                            max: 3,
                                            stepSize: 1
                                        }
                                    }]
                                },
                                title: {
                                    display: true,
                                    text: 'Alokasi Kursi DPR RI',
                                    fontSize: 16
                                },
                                legend: {
                                    display: false
                                }
                            }
                        });
                    }
        
                    //mengatur tampilan legenda
                    var legend = L.control({position: 'bottomright'}); // Menetapkan posisi legenda di bagian kanan bawah
                        legend.onAdd = function (map) {
                        var div = L.DomUtil.create('div', 'legend'),
                        kategori = ['TINGGI', 'SEDANG', 'RENDAH'];
                        partai = ['PKB', 'GERINDRA', 'PDIP', 'GOLKAR', 'NASDEM', 'PKS', 'PAN', 'DEMOKRAT'];
        
                     // Wrapper div untuk menampilkan elemen secara horizontal
                     var wrapper = L.DomUtil.create('div', 'legend-wrapper', div);
        
                    //var partaiDiv = L.DomUtil.create('div', 'legend-item', wrapper);
                    for (var j = 0; j < partai.length; j++) {
                        var partaiDiv = L.DomUtil.create('div', 'legend-item', wrapper);                                     
                        // Judul legenda untuk setiap pasangan calon
                        partaiDiv.innerHTML += '<h4 class="legend-tittle">' + partai[j] + '</h4>';
                        //loop setiap paslon       
                        for (var i = 0; i < kategori.length; i++) {
                            partaiDiv.innerHTML +=
                            '<div style="display: flex; align-items: center;">' + // Menggunakan flexbox untuk mengatur tata letak
                                '<i style="background:' + getColor(partai[j] + ' - ' + kategori[i]) + '"></i>' +
                                '<span style="width: 100px; display: inline-block">' + kategori[i] + '</span>' +
                            '</div>';
                        }
                    }
                    return div;
                    };
                    legend.addTo(map);
                    </script>
                </div>
            </div>
            <!--selesai-->
            </main>
        </div>
    </body>
</html>
